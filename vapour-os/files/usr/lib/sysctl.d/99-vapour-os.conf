######## [ KERNEL ] ########
# Enable Magic Sysrq functions
kernel.sysrq=178

# Disable: kexec, unpriviliged BPF programs, unprivileged user namespace usage
kernel.kexec_load_disabled = 1
kernel.unprivileged_bpf_disabled=1
kernel.unprivileged_userns_clone=0

# Hide kernel symbol addresses in /proc/kallsyms from regular users without CAP_SYSLOG
kernel.kptr_restrict = 1

# Set TT scheduler balancer to 3 (power save)
# https://github.com/hamadmarri/TT-CPU-Scheduler
kernel.sched_tt_balancer_opt = 3



######## [ NETWORK ] ########
# BPF hardening (priviliged and unpriviliged)
net.core.bpf_jit_harden = 2

# Increase size of recieve queue to 2048 (may increase latency if your CPU cannot keep up)
net.core.netdev_max_backlog = 2048

# Lower max connections to 1024
net.core.somaxconn = 1024

# BBR congestion control
net.core.default_qdisc = cake
net.ipv4.tcp_congestion_control = bbr

# Disable ICMP redirects
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0

# Increase Ephemeral port range (RFC 6056 recommends 1024-65536)
net.ipv4.ip_local_port_range = 1024 65535

# Allow TCP fast open for incoming/outgoing connections
net.ipv4.tcp_fastopen = 3

# Send keepalive probe after 30 seconds of idle, every 10 seconds and up to 10 times
net.ipv4.tcp_keepalive_time = 30
net.ipv4.tcp_keepalive_intvl = 10
net.ipv4.tcp_keepalive_probes = 10

# Enable MTU probing
net.ipv4.tcp_mtu_probing = 1

# Conform to RFC 1337. Protects against time-wait assasination hazards
net.ipv4.tcp_rfc1337 = 1

# Disable TCP slow start after idle
net.ipv4.tcp_slow_start_after_idle = 0

# TCP SYN cookie protection
net.ipv4.tcp_syncookies = 1

# Reuse sockets in TIME-WAIT state for new connections
net.ipv4.tcp_tw_reuse = 1



######## [ VM ] ########
vm.dirty_bytes = 104857600
vm.dirty_background_bytes = 104857600
vm.dirty_writeback_centisecs = 1500
vm.vfs_cache_pressure = 10
vm.swappiness = 1
vm.laptop_mode = 5
vm.zone_reclaim_mode = 0



######## [ i915 ] ########
dev.i915.perf_stream_paranoid=0
