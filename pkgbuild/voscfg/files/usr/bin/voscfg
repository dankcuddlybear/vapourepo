#!/bin/sh
DISTRO_NAME="$(cat /usr/lib/os-release | grep -i "PRETTY_NAME" | cut -d '=' -f 2 | sed 's/"//g')"
SCRIPT_DIR="$(readlink -f $( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd ))"
SCRIPT_USER="$(whoami)"
BACKTITLE="[$SCRIPT_USER] $DISTRO_NAME settings"
(groups "$SCRIPT_USER" | grep "wheel" &> /dev/null || [ $SCRIPT_USER == "root" ]) && IS_ADMIN=1 || IS_ADMIN=0
while true; do
	CHOICE=$(dialog --stdout --backtitle "$BACKTITLE" --title "Users" --menu "Main menu" 0 0 0 \
	"a" "Appearance" \
	"r" "Regional settings" \
	"t" "Time and date" \
	"u" "Users" \
	"n" "Network settings" \
	"p" "Power management" \
	"s" "System information" \
	"e" "Extra software"
	)
	if [ -z "$CHOICE" ]; then exit 125; else
		case $CHOICE in
			t) if [ $IS_ADMIN == 1 ]; then sudo "$SCRIPT_DIR/../lib/voscfg/timedate"; else
				dialog --backtitle "$BACKTITLE" --title "Error" --msgbox "You are not allowed to change system time settings." 0 0
				fi;;
			u) "$SCRIPT_DIR/../lib/voscfg/users";;
			p) if [ $IS_ADMIN == 1 ]; then sudo "$SCRIPT_DIR/../lib/voscfg/power"; else
				dialog --backtitle "$BACKTITLE" --title "Error" --msgbox "You are not allowed to change power management settings." 0 0
				fi;;
			*)
				dialog --backtitle "$BACKTITLE" --title "Error" --msgbox "Not yet implemented" 0 0;;
		esac
	fi
done
